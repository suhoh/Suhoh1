@using Suhoh.Model
@model ViewModel

@{
    ViewBag.Title = "Home";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section LeftPanelContent {
    @Html.Partial("LeftPanelPartial")
}

<script>
    var _headerHeight = 0;
    var _pieData = [{ 'value': 9, 'key': "a" }, { 'value': 20, 'key': "b" }, { 'value': 30, 'key': "c" }, { 'value': 8, 'key': "d" }, { 'value': 12, 'key': "e" }, { 'value': 3, 'key': "f" }, { 'value': 5, 'key': "g" }, { 'value': 7, 'key': "h" }, { 'value': 2, 'key': "i" }, { 'value': 7, 'key': "j" }, { 'value': 9, 'key': "k" }, { 'value': 9, 'key': "l" }]


    //window.addEventListener('resize', function (event) {
    //    console.log("window - innerWidth " + window.innerWidth);
    //    console.log("window - innerHeight " + window.innerHeight);
    //})

    function splitterMainResized(s, e) {
        _map.updateSize();

        var pGraph = splitterMain.GetPaneByName('paneGraph');
        var width = pGraph.GetClientWidth();
        var height = pGraph.GetClientHeight();
        var min = Math.min(width, height);
        drawPie('pieChart', _pieData, width, height, min/2);

        var pGridview = splitterMain.GetPaneByName('paneGridview');
        dxGridview.SetHeight(pGridview.GetClientHeight() - _headerHeight);
    }

</script>

<div style="width:100%;height:100%;position: relative;" id="MainContent">
    @*@Html.Raw(File.ReadAllText(Server.MapPath(@"~/App_Data/Overview.html")))*@

    @Html.DevExpress().Splitter(settings => {
        settings.Name = "splitterMain";
        //settings.Height = 800;  // no effect
        //settings.Width = System.Web.UI.WebControls.Unit.Percentage(100);  // no effect
        settings.Orientation = Orientation.Vertical;
        settings.AllowResize = true;
        settings.SeparatorVisible = true;
        settings.FullscreenMode = true;
        settings.Panes.Add(panes => {
            panes.Panes.Add(mapPane =>
            {
                mapPane.Name = "paneMap";
                mapPane.SetContent(() =>
                {
                    Html.RenderPartial("OpenLayerMap", Model);
                });

            });
            panes.Panes.Add(graphPane =>
            {
                graphPane.Name = "paneGraph";
                graphPane.SetContent(() =>
                {
                    Html.RenderPartial("D3Graph", Model);
                });

            });
        });
        settings.Panes.Add(gridviewPane => {
            gridviewPane.Name = "paneGridview";
            gridviewPane.Size = Unit.Percentage(30);
            gridviewPane.SetContent(() => {
                Html.RenderAction("DxGridview", Model);
            });
        });
        settings.ClientSideEvents.PaneResized = "splitterMainResized";
    }).GetHtml()
</div>

@*<div id="PieChart" style="background: yellow; top: 500px; left: 500px; z-index: 1000"></div>*@